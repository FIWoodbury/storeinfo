<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Store Map</title>
<link rel="manifest" href="manifest.json">
<style>
body{font-family:Arial;background:#f4f4f4;text-align:center}
.container{background:#fff;padding:15px;border-radius:8px;max-width:900px;margin:auto}
.image-wrap{position:relative}
.highlight{position:absolute;border:3px solid red;display:none}
.youarehere{position:absolute;width:16px;height:16px;border-radius:50%;background:blue;animation:pulse 1.5s infinite}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.5)}100%{transform:scale(1)}}
a,button,input,select{display:block;margin:6px auto;padding:12px;font-size:16px}
</style>
</head>
<body>
<div class="container">
<h2>üõí Store Map</h2>

<select onchange="setLang(this.value)">
<option value="en">English</option>
<option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
<option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
</select>

<input id="search" placeholder="Search item" onkeyup="searchItem()">
<button onclick="voiceSearch()">üé§ Voice Search</button>

<div class="image-wrap">
<img src="store-layout.jpg" id="img" width="100%">
<div id="highlight" class="highlight"></div>
<div class="youarehere" style="left:3%;top:90%"></div>
</div>

<div id="buttons"></div>
</div>

<script>
let lang='en',data;
fetch('data/aisles.json').then(r=>r.json()).then(d=>{data=d;render();});

function render(){
 const b=document.getElementById('buttons'); b.innerHTML='';
 for(let i in data){
  let a=document.createElement('a');
  a.href='aisles/aisle'+i+'.html';
  a.textContent=data[i]['name_'+lang];
  a.onclick=()=>highlight(i);
  b.appendChild(a);
 }
}

function highlight(i){
 const [x1,y1,x2,y2]=data[i].box;
 const img=document.getElementById('img');
 const h=document.getElementById('highlight');
 h.style.display='block';
 h.style.left=img.width*x1/100+'px';
 h.style.top=img.height*y1/100+'px';
 h.style.width=img.width*(x2-x1)/100+'px';
 h.style.height=img.height*(y2-y1)/100+'px';
}

function searchItem(){
 const q=document.getElementById('search').value.toLowerCase();
 for(let i in data){
  if(data[i].items.some(it=>it.toLowerCase().includes(q))){highlight(i);break;}
 }
}

function setLang(l){lang=l;render();}

function voiceSearch(){
 const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
 if(!SpeechRecognition){alert("Voice search not supported");return;}
 const rec = new SpeechRecognition();
 rec.lang = lang==='ta'?'ta-IN':lang==='hi'?'hi-IN':'en-US';
 rec.onresult = e => {
   document.getElementById('search').value = e.results[0][0].transcript;
   searchItem();
 };
 rec.start();
}

if('serviceWorker'in navigator){navigator.serviceWorker.register('sw.js')}
</script>
</body>
</html>
